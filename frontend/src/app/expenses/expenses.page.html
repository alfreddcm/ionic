<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-title>Wallet Management</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="wallet-content">
  <div *ngIf="isLoading" class="loading-container">
    <ion-spinner name="circles"></ion-spinner>
    <p>Loading wallets...</p>
  </div>

  <div *ngIf="!isLoading" class="wallets-section">
    <div class="section-header">
      <h3>
        <ion-icon name="wallet"></ion-icon>
        My Wallets
      </h3>
    </div>

    <div *ngIf="wallets.length === 0" class="empty-state">
      <ion-icon name="wallet-outline" class="empty-icon"></ion-icon>
      <h4>No Wallets Yet</h4>
      <p>Create your first wallet to start managing your finances</p>
      <ion-button expand="block" (click)="presentWalletModal()">
        <ion-icon name="add" slot="start"></ion-icon>
        Create Wallet
      </ion-button>
    </div>

    <div *ngIf="wallets.length > 0" class="wallets-grid">
      <div *ngFor="let wallet of wallets" class="wallet-item">
        <div class="wallet-card-header">
          <div class="wallet-icon-wrapper" [style.background]="getWalletGradient(wallet.walletname)">
            <ion-icon name="wallet"></ion-icon>
          </div>
          <div class="wallet-info">
            <h4 class="wallet-name">{{ wallet.walletname }}</h4>
            <p class="wallet-balance">₱{{ wallet.amount.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2}) }}</p>
          </div>
        </div>
        <div class="wallet-actions">
          <ion-button 
            fill="clear" 
            size="small" 
            (click)="editWallet(wallet)">
            <ion-icon name="create-outline" slot="icon-only"></ion-icon>
          </ion-button>
          <ion-button 
            fill="clear" 
            size="small" 
            color="danger"
            (click)="deleteWallet(wallet)">
            <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
          </ion-button>
        </div>
      </div>
    </div>
  </div>
  
  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button (click)="presentWalletModal()" color="primary">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>

<ion-modal [isOpen]="isModalOpen" (willDismiss)="cancelModal()">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>{{ editingWallet ? 'Edit Wallet' : 'Add Wallet' }}</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="cancelModal()">
            <ion-icon name="close-outline"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    
    <ion-content class="ion-padding">
      <form (ngSubmit)="saveWallet()">
        <ion-item>
          <ion-label position="stacked">Wallet Name *</ion-label>
          <ion-input
            [(ngModel)]="walletForm.walletname"
            name="walletname"
            placeholder="Enter wallet name"
            required>
          </ion-input>
        </ion-item>
        
        <ion-item *ngIf="editingWallet">
          <ion-label position="stacked">Current Balance</ion-label>
          <ion-input
            type="text"
            [value]="'₱' + editingWallet.amount.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})"
            readonly>
          </ion-input>
        </ion-item>
        
        <ion-item *ngIf="!editingWallet">
          <ion-label position="stacked">Initial Amount *</ion-label>
          <ion-input
            type="number"
            [(ngModel)]="walletForm.amount"
            name="amount"
            placeholder="0.00"
            step="0.01"
            required>
          </ion-input>
        </ion-item>

        <div *ngIf="editingWallet" class="fund-management">
          <ion-label class="fund-management-label">Fund Management</ion-label>
          
          <ion-radio-group [(ngModel)]="fundAction" name="fundAction" (ionChange)="onFundActionChange()">
            <ion-item>
              <ion-radio slot="start" value="update"></ion-radio>
              <ion-label>Update Balance</ion-label>
            </ion-item>
            <ion-item>
              <ion-radio slot="start" value="add"></ion-radio>
              <ion-label>Add Funds</ion-label>
            </ion-item>
            <ion-item>
              <ion-radio slot="start" value="deduct"></ion-radio>
              <ion-label>Deduct Funds</ion-label>
            </ion-item>
          </ion-radio-group>

          <ion-item>
            <ion-label position="stacked">
              {{ fundAction === 'update' ? 'New Balance' : 'Amount' }} *
            </ion-label>
            <ion-input
              type="number"
              [(ngModel)]="walletForm.amount"
              name="fundAmount"
              placeholder="0.00"
              step="0.01"
              required>
            </ion-input>
          </ion-item>

          <ion-item *ngIf="editingWallet && walletForm.amount && walletForm.amount !== '' && getNewBalancePreview() !== null" class="balance-preview">
            <ion-label>
              <h3>Balance Change:</h3>
              <p class="preview-amount">
                <span class="balance-before">₱{{ editingWallet.amount.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2}) }}</span>
                <ion-icon name="arrow-forward" class="arrow-icon"></ion-icon>
                <span class="balance-after" [class.positive]="getNewBalancePreview()! > editingWallet.amount" [class.negative]="getNewBalancePreview()! < editingWallet.amount">₱{{ getNewBalancePreview()?.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2}) }}</span>
              </p>
            </ion-label>
          </ion-item>
        </div>
        
        <div class="modal-buttons">
          <ion-button type="button" fill="outline" (click)="cancelModal()">
            Cancel
          </ion-button>
          <ion-button type="submit" color="primary">
            {{ editingWallet ? 'Save Changes' : 'Create' }}
          </ion-button>
        </div>
      </form>
    </ion-content>
  </ng-template>
</ion-modal>
