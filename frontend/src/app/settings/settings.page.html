<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-title>Settings</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="settings-content">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Settings</ion-title>
    </ion-toolbar>
  </ion-header>

  
  <ion-card class="material-card profile-card slide-in-up">
    <ion-card-content>
      <div class="profile-info">
        <ion-avatar class="profile-avatar">
          <i class="fas fa-user-circle"></i>
        </ion-avatar>
        <div class="profile-details" *ngIf="currentUser">
          <h2 style="color: #000000 !important; font-weight: 700;">{{ currentUser.name }}</h2>
          <p style="color: #000000 !important; font-weight: 500;">{{ currentUser.email }}</p>
          <small style="color: #666666 !important;">Member since {{ currentUser.created_at | date:'MMM yyyy' }}</small>
        </div>
        <div class="profile-details" *ngIf="!currentUser">
          <h2 style="color: #000000 !important; font-weight: 700;">Guest User</h2>
          <p style="color: #000000 !important; font-weight: 500;">Please login to access all features</p>
        </div>
      </div>
    </ion-card-content>
  </ion-card>

  
  <ion-card class="material-card settings-card slide-in-up">
    <ion-card-header>
      <ion-card-title>
        <i class="fas fa-cog"></i>
        Account Settings
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list lines="none">
        <ion-item button (click)="onEditProfile()" class="settings-item">
          <i class="fas fa-edit" slot="start"></i>
          <ion-label>
            <h3>Edit Profile</h3>
            <p>Update your personal information</p>
          </ion-label>
          <i class="fas fa-chevron-right" slot="end"></i>
        </ion-item>

        <ion-item button (click)="onChangePassword()" class="settings-item">
          <i class="fas fa-key" slot="start"></i>
          <ion-label>
            <h3>Change Password</h3>
            <p>Update your account password</p>
          </ion-label>
          <i class="fas fa-chevron-right" slot="end"></i>
        </ion-item>

        <ion-item button (click)="onNotificationSettings()" class="settings-item">
          <i class="fas fa-bell" slot="start"></i>
          <ion-label>
            <h3>Notifications</h3>
            <p>Manage notification preferences</p>
          </ion-label>
          <i class="fas fa-chevron-right" slot="end"></i>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>

  
  <ion-card class="material-card info-card slide-in-up">
    <ion-card-header>
      <ion-card-title>
        <i class="fas fa-info-circle"></i>
        App Information
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list lines="none">
        <ion-item class="info-item">
          <i class="fas fa-mobile-alt" slot="start"></i>
          <ion-label>
            <h3>Version</h3>
            <p>1.0.0</p>
          </ion-label>
        </ion-item>

        <ion-item class="info-item">
          <i class="fas fa-code-branch" slot="start"></i>
          <ion-label>
            <h3>Built with</h3>
            <p>Ionic Angular + CodeIgniter</p>
          </ion-label>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>

  
  <div class="logout-section">
    <ion-button 
      expand="block" 
      fill="clear" 
      color="danger" 
      (click)="onLogout()"
      class="logout-button">
      <i class="fas fa-sign-out-alt" slot="start"></i>
      Logout
    </ion-button>
  </div>
</ion-content>

<ion-modal [isOpen]="showEditProfileModal" (willDismiss)="cancelEditProfile()">
  <ng-template>
    <ion-header>
      <ion-toolbar color="primary">
        <ion-title>Edit Profile</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="cancelEditProfile()">
            <ion-icon name="close-outline"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    
    <ion-content class="ion-padding">
      <form (ngSubmit)="saveProfile()" #profileForm="ngForm">
        <ion-item>
          <ion-label position="stacked">Username *</ion-label>
          <ion-input
            [(ngModel)]="editForm.username"
            name="username"
            placeholder="Enter your username"
            #usernameInput="ngModel"
            required
            minlength="3"
            maxlength="20">
          </ion-input>
        </ion-item>
        <div class="error-message" *ngIf="usernameInput.invalid && usernameInput.touched">
          <ion-text color="danger">
            <small *ngIf="usernameInput.errors?.['required']">Username is required</small>
            <small *ngIf="usernameInput.errors?.['minlength']">Username must be at least 3 characters</small>
            <small *ngIf="usernameInput.errors?.['maxlength']">Username must not exceed 20 characters</small>
          </ion-text>
        </div>

        <ion-item>
          <ion-label position="stacked">Name *</ion-label>
          <ion-input
            [(ngModel)]="editForm.name"
            name="name"
            placeholder="Enter your name"
            #nameInput="ngModel"
            required
            minlength="2">
          </ion-input>
        </ion-item>
        <div class="error-message" *ngIf="nameInput.invalid && nameInput.touched">
          <ion-text color="danger">
            <small *ngIf="nameInput.errors?.['required']">Name is required</small>
            <small *ngIf="nameInput.errors?.['minlength']">Name must be at least 2 characters</small>
          </ion-text>
        </div>

        <ion-item>
          <ion-label position="stacked">Email *</ion-label>
          <ion-input
            [(ngModel)]="editForm.email"
            name="email"
            type="email"
            placeholder="Enter your email"
            #emailInput="ngModel"
            required
            email>
          </ion-input>
        </ion-item>
        <div class="error-message" *ngIf="emailInput.invalid && emailInput.touched">
          <ion-text color="danger">
            <small *ngIf="emailInput.errors?.['required']">Email is required</small>
            <small *ngIf="emailInput.errors?.['email']">Please enter a valid email address</small>
          </ion-text>
        </div>

        <div class="modal-buttons">
          <ion-button type="button" fill="outline" (click)="cancelEditProfile()">
            Cancel
          </ion-button>
          <ion-button type="submit" color="primary" [disabled]="profileForm.invalid">
            Save
          </ion-button>
        </div>
      </form>
    </ion-content>
  </ng-template>
</ion-modal>

<ion-modal [isOpen]="showChangePasswordModal" (willDismiss)="cancelChangePassword()">
  <ng-template>
    <ion-header>
      <ion-toolbar color="primary">
        <ion-title>Change Password</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="cancelChangePassword()">
            <ion-icon name="close-outline"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    
    <ion-content class="ion-padding">
      <form (ngSubmit)="savePassword()" #passwordFormRef="ngForm">
        <ion-item>
          <ion-label position="stacked">Current Password *</ion-label>
          <ion-input
            [(ngModel)]="passwordForm.currentPassword"
            name="currentPassword"
            type="password"
            placeholder="Enter current password"
            #currentPwdInput="ngModel"
            required>
          </ion-input>
        </ion-item>
        <div class="error-message" *ngIf="currentPwdInput.invalid && currentPwdInput.touched">
          <ion-text color="danger">
            <small *ngIf="currentPwdInput.errors?.['required']">Current password is required</small>
          </ion-text>
        </div>

        <ion-item>
          <ion-label position="stacked">New Password *</ion-label>
          <ion-input
            [(ngModel)]="passwordForm.newPassword"
            name="newPassword"
            type="password"
            placeholder="Enter new password (min 6 characters)"
            #newPwdInput="ngModel"
            required
            minlength="6">
          </ion-input>
        </ion-item>
        <div class="error-message" *ngIf="newPwdInput.invalid && newPwdInput.touched">
          <ion-text color="danger">
            <small *ngIf="newPwdInput.errors?.['required']">New password is required</small>
            <small *ngIf="newPwdInput.errors?.['minlength']">Password must be at least 6 characters</small>
          </ion-text>
        </div>

        <ion-item>
          <ion-label position="stacked">Confirm New Password *</ion-label>
          <ion-input
            [(ngModel)]="passwordForm.confirmPassword"
            name="confirmPassword"
            type="password"
            placeholder="Confirm new password"
            #confirmPwdInput="ngModel"
            required>
          </ion-input>
        </ion-item>
        <div class="error-message" *ngIf="confirmPwdInput.touched && passwordForm.newPassword !== passwordForm.confirmPassword">
          <ion-text color="danger">
            <small>Passwords do not match</small>
          </ion-text>
        </div>

        <div class="error-message" *ngIf="passwordError" style="margin-top: 12px; padding: 12px; background: #ffe6e6; border-radius: 8px;">
          <ion-text color="danger">
            <strong>{{ passwordError }}</strong>
          </ion-text>
        </div>

        <div class="modal-buttons">
          <ion-button type="button" fill="outline" (click)="cancelChangePassword()">
            Cancel
          </ion-button>
          <ion-button type="submit" color="primary" [disabled]="passwordFormRef.invalid || passwordForm.newPassword !== passwordForm.confirmPassword">
            Change Password
          </ion-button>
        </div>
      </form>
    </ion-content>
  </ng-template>
</ion-modal>